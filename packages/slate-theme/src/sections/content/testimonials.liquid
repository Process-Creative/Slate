{% liquid
  capture blocks
    for block in section.blocks
      assign reviewText = block.settings.review_text | replace: '<p', '<p class="c-testimonial__review o-paragraph"'
      capture c
        render 'object.testimonial' with { image: block.settings.image, cardTitle: block.settings.review_title, reviewText: reviewText, name: block.settings.name, location: block.settings.location, rating: block.settings.rating }
      endcapture
      if c == blank
        continue
      endif

      echo '<div class="c-testimonials__testimonial">'
      echo c
      echo '</div>'
    endfor 
  endcapture
%}

{%- if blocks != blank -%}
  <div class="c-testimonials" data-testimonials>
    <p class="c-testimonials__heading o-heading--3">
      {{- section.settings.heading | escape -}}
    </p>

    <div class="c-testimonials__carousel" data-testimonials-carousel>
      {{- blocks -}}
    </div>

    <div class="c-testimonials__progress">
      <div class="c-testimonials__progress-inner">
        <div data-testimonials-carousel-progress></div>
      </div>
    </div>
  </div>
{%- endif -%}

{% schema %}
  {
    "name": "Testimonials",
    "settings": [
      {
        "type": "header",
        "content": "Content"
      },
      {
        "type": "text",
        "id": "heading",
        "label": "Section Heading",
        "default": "Testimonials"
      }
    ],

    "blocks": [
      {
        "name": "Testimonial",
        "type": "testimonial",
        "settings": [
          {
            "type": "image_picker",
            "id": "image",
            "label": "Reviewer Image",
            "info": "Dimensions: 120px X 120px"
          },
          {
            "type": "textarea",
            "id": "review_title",
            "label": "Review Title"
          },
          {
            "type": "richtext",
            "id": "review_text",
            "label": "Review"
          },
          {
            "type": "range",
            "id": "rating",
            "label": "Rating (Out of 5)",
            "min": 1,
            "max": 5,
            "step": 1,
            "default": 5
          },
          {
            "type": "text",
            "id": "name",
            "label": "Reviewer's name"
          },
          {
            "type": "text",
            "id": "location",
            "label": "Location"
          }
        ]
      }
    ],

    "presets": [
      {
        "category": "Content",
        "name": "Testimonials"
      }
    ]
  }
{% endschema %}